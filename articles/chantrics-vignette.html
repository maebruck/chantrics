<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An introduction to chantrics â€¢ chantrics</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="An introduction to chantrics">
<meta property="og:description" content="chantrics">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-45196954-5"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-45196954-5');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">chantrics</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/chantrics-vignette.html">An introduction to chantrics</a>
    </li>
    <li>
      <a href="../articles/clustering-vignette.html">An introduction to clustering with chantrics</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/tbruckbauer/chantrics/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="chantrics-vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>An introduction to chantrics</h1>
                        <h4 class="author">Theo Bruckbauer</h4>
            
            <h4 class="date">2021-01-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/tbruckbauer/chantrics/blob/master/vignettes/chantrics-vignette.Rmd"><code>vignettes/chantrics-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>chantrics-vignette.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://chantrics.theobruckbauer.eu">chantrics</a></span><span class="op">)</span></code></pre></div>
<p><code>chantrics</code> applies the Chandler-Bate loglikelihood adjustment <span class="citation">(Chandler and Bate 2007)</span> implemented in the <a href="https://cran.r-project.org/package=chandwich">chandwich</a> package <span class="citation">(Northrop and Chandler 2020)</span> to different models frequently used in basic Econometrics applications. <code><a href="../reference/adj_loglik.html">adj_loglik()</a></code> is the central function of <code>chantrics</code>, it is a generic function adjusting the parameter covariance matrix of the models to incorporate clustered data, and can mitigate for model misspecification. The returned object can then be plugged into a range of model analysis functions, which will be described below. <a href="https://chantrics.theobruckbauer.eu/articles/clustering-vignette.html">For an introduction on modelling with clustered data using <code>chantrics</code>, visit this vignette</a>.</p>
<div id="functionality-for-singular-model-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#functionality-for-singular-model-objects" class="anchor"></a>Functionality for singular model objects</h2>
<p><em>Note that not all functionality demonstrated below is available for all types of models.</em></p>
<p>In order to be able to demonstrate the range of functionality available, this example will be using the misspecified count data regression from Chapter 5.1 in the Object-Oriented Computation of Sandwich Estimators vignette from the <em>sandwich</em> package <span class="citation">(Zeileis 2006)</span>.</p>
<p>First, data from a negative binomial model is generated, and then a Poisson model is fit, which is clearly misspecified.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">250</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html">rnbinom</a></span><span class="op">(</span><span class="fl">250</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">x</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="co">## Fit the Poisson glm model, which is not correctly specified</span>
<span class="va">fm_pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/glm.html">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, family <span class="op">=</span> <span class="va">poisson</span><span class="op">)</span>
<span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html">coeftest</a></span><span class="op">(</span><span class="va">fm_pois</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; z test of coefficients:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)  1.063268   0.041357 25.7094  &lt; 2e-16 ***</span>
<span class="co">#&gt; x            0.996072   0.053534 18.6062  &lt; 2e-16 ***</span>
<span class="co">#&gt; I(x^2)      -0.049124   0.023146 -2.1223  0.03381 *  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">## The I(x^2) term is spuriously significant.</span></code></pre></div>
<p>We can now use the model object <code>fm_pois</code>, and adjust it using <code><a href="../reference/adj_loglik.html">adj_loglik()</a></code>. Use <code><a href="https://rdrr.io/r/stats/coef.html">coef()</a></code> to get a vector of the coefficients, <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> to get an overview over the adjustment, or use <code><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html">lmtest::coeftest()</a></code> to see the results of <span class="math inline">\(z\)</span> tests on each of the coefficients.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fm_pois_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adj_loglik.html">adj_loglik</a></span><span class="op">(</span><span class="va">fm_pois</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fm_pois_adj</span><span class="op">)</span> <span class="co"># class "numeric"</span>
<span class="co">#&gt; (Intercept)           x      I(x^2) </span>
<span class="co">#&gt;  1.06326821  0.99607219 -0.04912373</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fm_pois_adj</span><span class="op">)</span>
<span class="co">#&gt;                  MLE       SE adj. SE</span>
<span class="co">#&gt; (Intercept)  1.06300  0.04136   0.084</span>
<span class="co">#&gt; x            0.99610  0.05353   0.105</span>
<span class="co">#&gt; I(x^2)      -0.04912  0.02315   0.036</span>
<span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html">coeftest</a></span><span class="op">(</span><span class="va">fm_pois_adj</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; z test of coefficients:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)  1.063268   0.083776 12.6918   &lt;2e-16 ***</span>
<span class="co">#&gt; x            0.996072   0.105217  9.4668   &lt;2e-16 ***</span>
<span class="co">#&gt; I(x^2)      -0.049124   0.036284 -1.3539   0.1758    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<div id="confidence-intervals-of-the-estimates" class="section level3">
<h3 class="hasAnchor">
<a href="#confidence-intervals-of-the-estimates" class="anchor"></a>Confidence intervals of the estimates</h3>
<p>The function <code><a href="https://rdrr.io/pkg/chandwich/man/conf_intervals.html">chandwich::conf_intervals()</a></code> returns confidence intervals at the level specified in <code>conf</code> (default: <code>95</code>). To use one of the other specifications of the adjustment from <span class="citation">Chandler and Bate (2007)</span>, use the <code>type</code> argument. Many other adjustments are available. The classic S3 method <code><a href="https://rdrr.io/r/stats/confint.html">confint()</a></code> is also available.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">chandwich</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chandwich/man/conf_intervals.html">conf_intervals</a></span><span class="op">(</span><span class="va">fm_pois_adj</span><span class="op">)</span>
<span class="co">#&gt; Waiting for profiling to be done...</span>
<span class="co">#&gt; Model: poisson_glm_lm </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 95% confidence intervals, adjusted loglikelihod with type = ''vertical'' </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Symmetric:</span>
<span class="co">#&gt;              lower     upper   </span>
<span class="co">#&gt; (Intercept)   0.89907   1.22747</span>
<span class="co">#&gt; x             0.78985   1.20229</span>
<span class="co">#&gt; I(x^2)       -0.12024   0.02199</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Profile likelihood-based:</span>
<span class="co">#&gt;              lower    upper  </span>
<span class="co">#&gt; (Intercept)   0.8954   1.2232</span>
<span class="co">#&gt; x             0.7877   1.1991</span>
<span class="co">#&gt; I(x^2)       -0.1198   0.0222</span>
<span class="fu">chandwich</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chandwich/man/conf_intervals.html">conf_intervals</a></span><span class="op">(</span><span class="va">fm_pois_adj</span>, type <span class="op">=</span> <span class="st">"spectral"</span>, conf <span class="op">=</span> <span class="fl">99</span><span class="op">)</span>
<span class="co">#&gt; Waiting for profiling to be done...</span>
<span class="co">#&gt; Model: poisson_glm_lm </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 99% confidence intervals, adjusted loglikelihod with type = ''spectral'' </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Symmetric:</span>
<span class="co">#&gt;              lower     upper   </span>
<span class="co">#&gt; (Intercept)   0.84748   1.27906</span>
<span class="co">#&gt; x             0.72505   1.26709</span>
<span class="co">#&gt; I(x^2)       -0.14258   0.04434</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Profile likelihood-based:</span>
<span class="co">#&gt;              lower     upper   </span>
<span class="co">#&gt; (Intercept)   0.84491   1.27554</span>
<span class="co">#&gt; x             0.73069   1.27167</span>
<span class="co">#&gt; I(x^2)       -0.14497   0.04169</span>
<span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">fm_pois_adj</span><span class="op">)</span>
<span class="co">#&gt; Waiting for profiling to be done...</span>
<span class="co">#&gt;                  2.5 %     97.5 %</span>
<span class="co">#&gt; (Intercept)  0.8954172 1.22323347</span>
<span class="co">#&gt; x            0.7876855 1.19906286</span>
<span class="co">#&gt; I(x^2)      -0.1198278 0.02220215</span></code></pre></div>
<p>We can also plot confidence regions of the estimates for two coefficients using <code><a href="https://rdrr.io/pkg/chandwich/man/conf_region.html">chandwich::conf_region()</a></code>, where we can specify the parameters using <code>which_pars</code>, the type of specification of the adjustment from <span class="citation">Chandler and Bate (2007)</span> using <code>type</code>, and the confidence levels using <code>conf</code>. Other adjustments are available.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fm_pois_adj_vert</span> <span class="op">&lt;-</span>
  <span class="fu">chandwich</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chandwich/man/conf_region.html">conf_region</a></span><span class="op">(</span><span class="va">fm_pois_adj</span>, which_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"I(x^2)"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Waiting for profiling to be done...</span>
<span class="va">fm_pois_adj_none</span> <span class="op">&lt;-</span>
  <span class="fu">chandwich</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chandwich/man/conf_region.html">conf_region</a></span><span class="op">(</span><span class="va">fm_pois_adj</span>,
    which_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"I(x^2)"</span><span class="op">)</span>,
    type <span class="op">=</span> <span class="st">"none"</span>
  <span class="op">)</span>
<span class="co">#&gt; Waiting for profiling to be done...</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>
  <span class="va">fm_pois_adj_vert</span>,
  <span class="va">fm_pois_adj_none</span>,
  conf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">80</span>, <span class="fl">90</span>, <span class="fl">95</span><span class="op">)</span>,
  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"brown"</span>, <span class="st">"darkgreen"</span><span class="op">)</span>,
  lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,
  lwd <span class="op">=</span> <span class="fl">2.5</span>
<span class="op">)</span></code></pre></div>
<p><img src="chantrics-vignette_files/figure-html/conf_region-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="other-diagnostic-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#other-diagnostic-functions" class="anchor"></a>Other diagnostic functions</h3>
<p>The methods</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/stats/AIC.html">AIC()</a></code> for the Akaike Information Criterion,</li>
<li>
<code><a href="https://rdrr.io/r/stats/df.residual.html">df.residual()</a></code> for the degrees of freedom of the residuals</li>
<li>
<code><a href="https://rdrr.io/r/stats/fitted.values.html">fitted()</a></code> for the fitted values,</li>
<li>
<code><a href="https://rdrr.io/r/stats/logLik.html">logLik()</a></code> for the sum of the loglikelihoods and <code><a href="../reference/logLik_vec.html">logLik_vec()</a></code> for the loglikelihood contributions for each of the observations, and</li>
<li>
<code><a href="https://rdrr.io/r/stats/vcov.html">vcov()</a></code> for the variance-covariance matrix, are available.</li>
</ul>
<p>The performance of the types of adjustments that are shown in <span class="citation">Chandler and Bate (2007)</span> can be seen using <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> if there is a single free parameter. Use <code>type</code> to specify the types of adjustment that should show in the plot.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fm_pois_smallest_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">fm_pois_adj</span>, <span class="va">.</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fm_pois_smallest_adj</span>, type <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, legend_pos <span class="op">=</span> <span class="st">"bottom"</span>, lwd <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></code></pre></div>
<p><img src="chantrics-vignette_files/figure-html/plot_chan-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Note that for one free parameter, the Cholesky and the spectral adjustments are identical, and the vertical adjustment only deviates slightly at the edges of the plot.</p>
</div>
</div>
<div id="functionality-for-multiple-model-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#functionality-for-multiple-model-objects" class="anchor"></a>Functionality for multiple model objects</h2>
<p>In order to have a wider range of coefficients to do model comparisons on, we will follow a Probit regression example in <span class="citation">Kleiber and Zeileis (2008, 124)</span> using the <code>SwissLabor</code> dataset from the <code>AER</code> package <span class="citation">(Kleiber and Zeileis 2020)</span>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"SwissLabor"</span>, package <span class="op">=</span> <span class="st">"AER"</span><span class="op">)</span>
<span class="va">swiss_probit</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/glm.html">glm</a></span><span class="op">(</span><span class="va">participation</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">age</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span>,
      data <span class="op">=</span> <span class="va">SwissLabor</span>,
      family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"probit"</span><span class="op">)</span><span class="op">)</span>
<span class="va">swiss_probit_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adj_loglik.html">adj_loglik</a></span><span class="op">(</span><span class="va">swiss_probit</span><span class="op">)</span>
<span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/coeftest.html">coeftest</a></span><span class="op">(</span><span class="va">swiss_probit_adj</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; z test of coefficients:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;              Estimate Std. Error z value  Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)  3.749091   1.327072  2.8251  0.004727 ** </span>
<span class="co">#&gt; income      -0.666941   0.127292 -5.2395 1.611e-07 ***</span>
<span class="co">#&gt; age          2.075297   0.398580  5.2067 1.922e-07 ***</span>
<span class="co">#&gt; education    0.019196   0.017935  1.0703  0.284479    </span>
<span class="co">#&gt; youngkids   -0.714487   0.106095 -6.7344 1.646e-11 ***</span>
<span class="co">#&gt; oldkids     -0.146984   0.051609 -2.8480  0.004399 ** </span>
<span class="co">#&gt; foreignyes   0.714373   0.122437  5.8346 5.391e-09 ***</span>
<span class="co">#&gt; I(age^2)    -0.294344   0.049527 -5.9430 2.798e-09 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<div id="creating-nested-models" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-nested-models" class="anchor"></a>Creating nested models</h3>
<p>The <code><a href="https://rdrr.io/r/stats/update.html">update()</a></code> function is also available for <code>chantrics</code> objects, it automatically re-estimates the updated model, and adjusts the loglikelihood.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">swiss_probit_small_adj</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">swiss_probit_adj</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">age</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span> <span class="va">education</span><span class="op">)</span>
<span class="va">swiss_probit_smaller_adj</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">swiss_probit_adj</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">age</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span> <span class="va">education</span> <span class="op">-</span> <span class="va">youngkids</span> <span class="op">-</span> <span class="va">oldkids</span><span class="op">)</span></code></pre></div>
</div>
<div id="compare-nested-models" class="section level3">
<h3 class="hasAnchor">
<a href="#compare-nested-models" class="anchor"></a>Compare nested models</h3>
<p>Nested models can be compared with <code><a href="https://rdrr.io/r/stats/anova.html">anova()</a></code> using an adjusted likelihood ratio test as outlined in Section 3.5 in <span class="citation">Chandler and Bate (2007)</span>. The type of adjustment can again be set using <code>type</code>. <code><a href="https://rdrr.io/r/stats/anova.html">anova()</a></code> sorts the models by the number of free variables as returned by <code><a href="https://rdrr.io/r/base/attr.html">attr(model, "p_current")</a></code>, where <code>model</code> is the <code>chantrics</code> model object.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">swiss_probit_adj</span>, <span class="va">swiss_probit_small_adj</span>, <span class="va">swiss_probit_smaller_adj</span><span class="op">)</span>
<span class="co">#&gt; Analysis of Adjusted Deviance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model 1: participation ~ income + age + education + youngkids + oldkids + </span>
<span class="co">#&gt;     foreign + I(age^2)</span>
<span class="co">#&gt; Model 2: participation ~ income + age + youngkids + oldkids + foreign</span>
<span class="co">#&gt; Model 3: participation ~ income + age + foreign</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Resid.df df  ALRTS Pr(&gt;ALRTS)    </span>
<span class="co">#&gt; 1      864                         </span>
<span class="co">#&gt; 2      866  2 37.359  7.721e-09 ***</span>
<span class="co">#&gt; 3      868  2 53.619  2.274e-12 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p>By passing in a singular model, we can also use <code><a href="https://rdrr.io/r/stats/anova.html">anova()</a></code> to generate a <em>sequential</em> analysis of deviance table, where each of the covariates is sequentially removed from the model.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">swiss_probit_adj</span><span class="op">)</span>
<span class="co">#&gt; Analysis of Adjusted Deviance Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model 1: participation ~ income + age + education + youngkids + oldkids + </span>
<span class="co">#&gt;     foreign + I(age^2)</span>
<span class="co">#&gt; Model 2: participation ~ income + age + education + youngkids + oldkids + </span>
<span class="co">#&gt;     foreign</span>
<span class="co">#&gt; Model 3: participation ~ income + age + education + youngkids + oldkids</span>
<span class="co">#&gt; Model 4: participation ~ income + age + education + youngkids</span>
<span class="co">#&gt; Model 5: participation ~ income + age + education</span>
<span class="co">#&gt; Model 6: participation ~ income + age</span>
<span class="co">#&gt; Model 7: participation ~ income</span>
<span class="co">#&gt; Model 8: participation ~ 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;            Resid.df df  ALRTS Pr(&gt;ALRTS)    </span>
<span class="co">#&gt; full model      864                         </span>
<span class="co">#&gt; I(age^2)        865  1 36.891  1.249e-09 ***</span>
<span class="co">#&gt; foreign         866  1 45.540  1.496e-11 ***</span>
<span class="co">#&gt; oldkids         867  1  0.027   0.870406    </span>
<span class="co">#&gt; youngkids       868  1 43.763  3.707e-11 ***</span>
<span class="co">#&gt; education       869  1  3.531   0.060230 .  </span>
<span class="co">#&gt; age             870  1  7.661   0.005644 ** </span>
<span class="co">#&gt; income          871  1 27.866  1.300e-07 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p>Another way of performing an adjusted likelihood ration test is by using <code><a href="../reference/alrtest.html">alrtest()</a></code>, which is inspired and similar in usage to <code><a href="https://rdrr.io/pkg/lmtest/man/waldtest.html">lmtest::waldtest()</a></code> and <code><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html">lmtest::lrtest()</a></code>, where a model, and an indicator of the variables that should be restricted/removed. These indicators can be <em>character strings</em> of the names of the covariates, <em>integers</em> corresponding to the position of a covariate, <em>formula</em> objects, or <em>nested model objects</em>, allowing a flexible and easy specification of nested models.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/alrtest.html">alrtest</a></span><span class="op">(</span><span class="va">swiss_probit_adj</span>, <span class="fl">3</span>, <span class="st">"oldkids"</span><span class="op">)</span>
<span class="co">#&gt; Adjusted likelihood ratio test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model 1: participation ~ income + age + education + youngkids + oldkids + </span>
<span class="co">#&gt;     foreign + I(age^2)</span>
<span class="co">#&gt; Model 2: participation ~ income + age + youngkids + oldkids + foreign + </span>
<span class="co">#&gt;     I(age^2)</span>
<span class="co">#&gt; Model 3: participation ~ income + age + youngkids + foreign + I(age^2)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Resid.df df  ALRTS Pr(&gt;ALRTS)   </span>
<span class="co">#&gt; 1      864                        </span>
<span class="co">#&gt; 2      865  1 1.1556   0.282373   </span>
<span class="co">#&gt; 3      866  1 8.8500   0.002931 **</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="fu"><a href="../reference/alrtest.html">alrtest</a></span><span class="op">(</span><span class="va">swiss_probit_adj</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">youngkids</span> <span class="op">-</span> <span class="va">foreign</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">education</span><span class="op">)</span>
<span class="co">#&gt; Adjusted likelihood ratio test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model 1: participation ~ income + age + education + youngkids + oldkids + </span>
<span class="co">#&gt;     foreign + I(age^2)</span>
<span class="co">#&gt; Model 2: participation ~ income + age + education + oldkids + I(age^2)</span>
<span class="co">#&gt; Model 3: participation ~ income + age + oldkids + I(age^2)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Resid.df df  ALRTS Pr(&gt;ALRTS)    </span>
<span class="co">#&gt; 1      864                         </span>
<span class="co">#&gt; 2      866  2 84.759     &lt;2e-16 ***</span>
<span class="co">#&gt; 3      867  1  1.653     0.1985    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="fu"><a href="../reference/alrtest.html">alrtest</a></span><span class="op">(</span><span class="va">swiss_probit_adj</span>, <span class="va">swiss_probit_small_adj</span><span class="op">)</span>
<span class="co">#&gt; Adjusted likelihood ratio test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model 1: participation ~ income + age + education + youngkids + oldkids + </span>
<span class="co">#&gt;     foreign + I(age^2)</span>
<span class="co">#&gt; Model 2: participation ~ income + age + youngkids + oldkids + foreign</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Resid.df df  ALRTS Pr(&gt;ALRTS)    </span>
<span class="co">#&gt; 1      864                         </span>
<span class="co">#&gt; 2      866  2 37.359  7.721e-09 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
</div>
</div>
<div id="supported-models" class="section level2">
<h2 class="hasAnchor">
<a href="#supported-models" class="anchor"></a>Supported models</h2>
<div id="glm-models" class="section level3">
<h3 class="hasAnchor">
<a href="#glm-models" class="anchor"></a><code>glm</code> models</h3>
<p>In a generalised linear model (glm), the user can choose between a range of distributions of a response <span class="math inline">\(y\)</span>, and can allow for non-linear relations between the mean outcome for a certain combination of covariates <span class="math inline">\(x\)</span>, <span class="math inline">\(\operatorname{E}(y_i\mid x_i)=\mu_i\)</span>, and the linear predictor, <span class="math inline">\(\eta_i=x_i^T\beta\)</span>, which is the link function <span class="math inline">\(g(\mu_i)=\eta_i\)</span>. The link function is required to be monotonic. (For a quick introduction, see <span class="citation">Kleiber and Zeileis (2008, Ch. 5.1)</span>, for a more complete coverage of the topic, see, for example, <span class="citation">Davison (2003, Ch. 10.3)</span>)</p>
<p>Within the array of <code>glm</code> families presented below, any link function should work.</p>
<div id="poisson-family" class="section level4">
<h4 class="hasAnchor">
<a href="#poisson-family" class="anchor"></a><code>poisson</code> family</h4>
<p>The Poisson family of models are commonly used specifications for count models. The specification of this form of a GLM is (for the canonical log-link of the Poisson specification),</p>
<p><span class="math display">\[\begin{equation*}
\operatorname{E}(y_i\mid x_i)=\mu_i=\exp(x_i^T\beta).
\end{equation*}\]</span></p>
<p>In this example, I will reuse the example of the misspecified count data regression from Chapter 5.1 in the Object-Oriented Computation of Sandwich Estimators vignette from the <em>sandwich</em> package <span class="citation">(Zeileis 2006)</span>. More on the Poisson specification in glms can be found in <span class="citation">Cameron and Trivedi (2013, Ch. 3.2.4)</span> or <span class="citation">Davison (2003, Example 10.10)</span>. More on the implementation in R is located in <span class="citation">Zeileis, Kleiber, and Jackman (2008, Ch. 2.1)</span>, and in <span class="citation">Kleiber and Zeileis (2008, Ch. 5.3)</span>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fm_pois</span><span class="op">)</span> <span class="co"># fm_pois is the fitted poisson model from above.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; glm(formula = y ~ x + I(x^2), family = poisson)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -5.6471  -1.6122  -0.6344   0.7245   7.1645  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)  1.06327    0.04136  25.709   &lt;2e-16 ***</span>
<span class="co">#&gt; x            0.99607    0.05353  18.606   &lt;2e-16 ***</span>
<span class="co">#&gt; I(x^2)      -0.04912    0.02315  -2.122   0.0338 *  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for poisson family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 1998.1  on 249  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 1069.7  on 247  degrees of freedom</span>
<span class="co">#&gt; AIC: 1635.2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 5</span>
<span class="va">fm_pois_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adj_loglik.html">adj_loglik</a></span><span class="op">(</span><span class="va">fm_pois</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fm_pois_adj</span><span class="op">)</span>
<span class="co">#&gt;                  MLE       SE adj. SE</span>
<span class="co">#&gt; (Intercept)  1.06300  0.04136   0.084</span>
<span class="co">#&gt; x            0.99610  0.05353   0.105</span>
<span class="co">#&gt; I(x^2)      -0.04912  0.02315   0.036</span></code></pre></div>
</div>
<div id="binomial-family" class="section level4">
<h4 class="hasAnchor">
<a href="#binomial-family" class="anchor"></a><code>binomial</code> family</h4>
<p>The binomial family of models is widely used for binary choice modelling of probabilities of choosing a certain option given a set of properties. As <span class="math inline">\(\operatorname{E}(y_i\mid x_i)=1\cdot P(y_i=1\mid x_i)+0\cdot P(y_i=0\mid x_i)=P(y_i=1\mid x_i\)</span>, the point estimation of the model is the probability of <span class="math inline">\(y_i\)</span> being equal to 1. It is specified using the GLM framework described above, with <span class="math display">\[\begin{equation*}
\operatorname{E}(y_i\mid x_i)=P(y_i=1)=p_i=F(x_i^T\beta),
\end{equation*}\]</span> where <span class="math inline">\(F\)</span> is a valid cdf of the error terms in the model, or, equally, the link function. Most commonly, these are chosen to be either the standard normal cdf in the Probit case, <code>family = binomial(link = "probit")</code>, or the logistic cdf in the logit case, <code>family = binomial(link = "logit")</code>.</p>
<p>This example will use the <code>SwissLabor</code> example in <span class="citation">Kleiber and Zeileis (2008, pg. 124)</span></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"SwissLabor"</span>, package <span class="op">=</span> <span class="st">"AER"</span><span class="op">)</span>
<span class="co">## Fitting a Probit model</span>
<span class="va">swiss_probit</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/glm.html">glm</a></span><span class="op">(</span><span class="va">participation</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">age</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span>,
      data <span class="op">=</span> <span class="va">SwissLabor</span>,
      family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"probit"</span><span class="op">)</span><span class="op">)</span>
<span class="va">swiss_probit_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adj_loglik.html">adj_loglik</a></span><span class="op">(</span><span class="va">swiss_probit</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">swiss_probit_adj</span><span class="op">)</span>
<span class="co">#&gt;                  MLE       SE adj. SE</span>
<span class="co">#&gt; (Intercept)  3.74900  1.40700   1.327</span>
<span class="co">#&gt; income      -0.66690  0.13200   0.127</span>
<span class="co">#&gt; age          2.07500  0.40540   0.399</span>
<span class="co">#&gt; education    0.01920  0.01793   0.018</span>
<span class="co">#&gt; youngkids   -0.71450  0.10040   0.106</span>
<span class="co">#&gt; oldkids     -0.14700  0.05089   0.052</span>
<span class="co">#&gt; foreignyes   0.71440  0.12130   0.122</span>
<span class="co">#&gt; I(age^2)    -0.29430  0.04995   0.050</span>

<span class="co">## Fitting a Logit model</span>
<span class="va">swiss_logit</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/glm.html">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="va">swiss_probit</span><span class="op">)</span>,
      data <span class="op">=</span> <span class="va">SwissLabor</span>,
      family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span>
<span class="va">swiss_logit_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adj_loglik.html">adj_loglik</a></span><span class="op">(</span><span class="va">swiss_logit</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">swiss_logit_adj</span><span class="op">)</span>
<span class="co">#&gt;                  MLE       SE adj. SE</span>
<span class="co">#&gt; (Intercept)  6.19600  2.38300   2.293</span>
<span class="co">#&gt; income      -1.10400  0.22570   0.221</span>
<span class="co">#&gt; age          3.43700  0.68790   0.672</span>
<span class="co">#&gt; education    0.03266  0.02999   0.030</span>
<span class="co">#&gt; youngkids   -1.18600  0.17200   0.182</span>
<span class="co">#&gt; oldkids     -0.24090  0.08446   0.086</span>
<span class="co">#&gt; foreignyes   1.16800  0.20380   0.206</span>
<span class="co">#&gt; I(age^2)    -0.48760  0.08519   0.084</span></code></pre></div>
<p>Note that other specifications of the link function are possible, the code is agnostic towards the link function.</p>
</div>
<div id="gaussian-family" class="section level4">
<h4 class="hasAnchor">
<a href="#gaussian-family" class="anchor"></a><code>gaussian</code> family</h4>
<p>The GLM framework encompasses the estimation of a standard linear regression using maximum likelihood estimators, therefore we can use the adjustment to account for clustering/misspecifications in the regression. We can use the classic assumption of normally distributed error terms to specify the distribution of <span class="math inline">\(y\)</span>. The link is simply the identity function. <span class="citation">(Kleiber and Zeileis 2008, pg. 123)</span></p>
<p>To demonstrate the functionality, I will employ the linear regression example in <span class="citation">Kleiber and Zeileis (2008, pg. 66)</span>, using the cross-sectional <code>CPS1988</code> data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"CPS1988"</span>, package <span class="op">=</span> <span class="st">"AER"</span><span class="op">)</span>
<span class="va">cps_glm</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/glm.html">glm</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">wage</span><span class="op">)</span> <span class="op">~</span> <span class="va">experience</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">experience</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span> <span class="va">ethnicity</span>,
    data <span class="op">=</span> <span class="va">CPS1988</span>,
    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cps_glm</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; glm(formula = log(wage) ~ experience + I(experience^2) + education + </span>
<span class="co">#&gt;     ethnicity, family = gaussian(), data = CPS1988)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -2.9428  -0.3162   0.0580   0.3756   4.3830  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                   Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)      4.321e+00  1.917e-02  225.38   &lt;2e-16 ***</span>
<span class="co">#&gt; experience       7.747e-02  8.800e-04   88.03   &lt;2e-16 ***</span>
<span class="co">#&gt; I(experience^2) -1.316e-03  1.899e-05  -69.31   &lt;2e-16 ***</span>
<span class="co">#&gt; education        8.567e-02  1.272e-03   67.34   &lt;2e-16 ***</span>
<span class="co">#&gt; ethnicityafam   -2.434e-01  1.292e-02  -18.84   &lt;2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 0.3409812)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 14428.3  on 28154  degrees of freedom</span>
<span class="co">#&gt; Residual deviance:  9598.6  on 28150  degrees of freedom</span>
<span class="co">#&gt; AIC: 49615</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 2</span>
<span class="va">cps_glm_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adj_loglik.html">adj_loglik</a></span><span class="op">(</span><span class="va">cps_glm</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cps_glm_adj</span><span class="op">)</span>
<span class="co">#&gt;                        MLE         SE adj. SE</span>
<span class="co">#&gt; (Intercept)      4.321e+00  1.917e-02   0.021</span>
<span class="co">#&gt; experience       7.747e-02  8.800e-04   0.001</span>
<span class="co">#&gt; I(experience^2) -1.316e-03  1.899e-05   0.000</span>
<span class="co">#&gt; education        8.567e-02  1.272e-03   0.001</span>
<span class="co">#&gt; ethnicityafam   -2.434e-01  1.292e-02   0.013</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter taken to be 0.341)</span></code></pre></div>
</div>
<div id="massnegative-binomial-and-massglm-nb" class="section level4">
<h4 class="hasAnchor">
<a href="#massnegative-binomial-and-massglm-nb" class="anchor"></a><code>MASS::negative.binomial</code> and <code>MASS::glm.nb()</code>
</h4>
<p>Another commonly used model for count data is the negative binomial model. It overcomes two issues of the Poisson model, that the expectation and the variance are assumed to be equal, and that in most datasets, the number of zeros is underestimated by Poisson family models.</p>
<p>The method of estimation of the negative binomial model depends on whether the dispersion parameter <span class="math inline">\(\theta\)</span> of the pmf, <span class="math display">\[\begin{equation*}
f(y;\mu,\theta)=\frac{\Gamma(\theta+y)}{\Gamma(\theta)y!}\frac{\mu^y\theta^\theta}{(\mu+\theta)^{y+\theta}}
\end{equation*}\]</span> is known. In most cases, it is not known, and the specialised function <code><a href="https://rdrr.io/pkg/MASS/man/glm.nb.html">MASS::glm.nb()</a></code> can be used, which estimates the negative binomial model and the <span class="math inline">\(\theta\)</span> parameter seperately. If <span class="math inline">\(\theta\)</span> is known, the <strong>MASS</strong> package <span class="citation">(Venables and Ripley 2002)</span> provides the <code><a href="https://rdrr.io/pkg/MASS/man/negative.binomial.html">MASS::negative.binomial()</a></code> family function for <code><a href="../reference/glm.html">glm()</a></code>.</p>
<p>A quick introduction can be found in <span class="citation">Kleiber and Zeileis (2008, pg. 135f.)</span> and in <span class="citation">Zeileis, Kleiber, and Jackman (2008, pg. 5)</span>, and a more general treatment with estimation using direct ML estimation in <span class="citation">Cameron and Trivedi (2013, Ch. 3.3)</span>.</p>
<p>Note that <code><a href="../reference/adj_loglik.html">adj_loglik()</a></code> re-estimates the theta parameter of a <code>glm.nb</code> model.</p>
<p>To demonstrate the negative binomial model functions, we will use the negative binomial data generated above, which we have falsely fitted to a Poisson model.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fm_negbin_theta</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/glm.nb.html">glm.nb</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fm_negbin_theta</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; MASS::glm.nb(formula = y ~ x, init.theta = 1.07845966, link = log)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -2.3259  -1.1607  -0.3757   0.3033   2.6729  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)  1.02881    0.07514   13.69   &lt;2e-16 ***</span>
<span class="co">#&gt; x            0.95909    0.07913   12.12   &lt;2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for Negative Binomial(1.0785) family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 442.32  on 249  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 267.02  on 248  degrees of freedom</span>
<span class="co">#&gt; AIC: 1118.7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;               Theta:  1.078 </span>
<span class="co">#&gt;           Std. Err.:  0.143 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  2 x log-likelihood:  -1112.662</span>
<span class="va">fm_negbin_theta_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adj_loglik.html">adj_loglik</a></span><span class="op">(</span><span class="va">fm_negbin_theta</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fm_negbin_theta_adj</span><span class="op">)</span>
<span class="co">#&gt;                 MLE      SE adj. SE</span>
<span class="co">#&gt; (Intercept) 1.02900 0.07514   0.077</span>
<span class="co">#&gt; x           0.95910 0.07913   0.069</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Theta: 1.078, SE: 0.1432)</span></code></pre></div>
</div>
</div>
<div id="hurdle-models" class="section level3">
<h3 class="hasAnchor">
<a href="#hurdle-models" class="anchor"></a>hurdle models</h3>
<p>WIP.</p>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-cameron13">
<p>Cameron, Adrian Colin, and Pravin K. Trivedi. 2013. <em>Regression Analysis of Count Data</em>. Second edition. Econometric Society Monographs (53). Cambridge University Press. <a href="https://doi.org/10.1017/CBO9781139013567">https://doi.org/10.1017/CBO9781139013567</a>.</p>
</div>
<div id="ref-chanbate07">
<p>Chandler, Richard E., and Steven Bate. 2007. â€œInference for Clustered Data Using the Independence Loglikelihood.â€ <em>Biometrika</em> 94 (1): 167â€“83. <a href="https://doi.org/doi:10.1093/biomet/asm015">https://doi.org/doi:10.1093/biomet/asm015</a>.</p>
</div>
<div id="ref-davison03">
<p>Davison, A. C. 2003. <em>Statistical Models</em>. Cambridge Series on Statistical and Probabilistic Mathematics 11. Cambridge University Press, Cambridge. <a href="www.cambridge.org/9780521773393">www.cambridge.org/9780521773393</a>.</p>
</div>
<div id="ref-AER-book">
<p>Kleiber, Christian, and Achim Zeileis. 2008. <em>Applied Econometrics with R</em>. Edited by Robert Gentleman, Kurt Hornik, and Giovanni Parmigiani. Use R! New York: Springer-Verlag.</p>
</div>
<div id="ref-AER">
<p>â€”â€”â€”. 2020. <em>Package AER: Applied Econometrics with R</em>. 1.2-9th ed. <a href="https://cran.r-project.org/package=AER">https://cran.r-project.org/package=AER</a>.</p>
</div>
<div id="ref-chandwich">
<p>Northrop, Paul J., and Richard E. Chandler. 2020. <em>Chandwich: Chandler-Bate Sandwich Loglikelihood Adjustment</em>. <a href="https://CRAN.R-project.org/package=chandwich">https://CRAN.R-project.org/package=chandwich</a>.</p>
</div>
<div id="ref-mass">
<p>Venables, W. N., and B. D. Ripley. 2002. <em>Modern Applied Statistics with S</em>. Fourth. New York: Springer-Verlag, New York. <a href="http://www.stats.ox.ac.uk/pub/MASS4/">http://www.stats.ox.ac.uk/pub/MASS4/</a>.</p>
</div>
<div id="ref-zeileis06">
<p>Zeileis, Achim. 2006. â€œObject-Oriented Computation of Sandwich Estimators.â€ <em>Journal of Statistical Software, Articles</em> 16 (9): 1â€“16. <a href="https://doi.org/10.18637/jss.v016.i09">https://doi.org/10.18637/jss.v016.i09</a>.</p>
</div>
<div id="ref-count-zeil">
<p>Zeileis, Achim, Christian Kleiber, and Simon Jackman. 2008. â€œRegression Models for Count Data in R.â€ <em>Journal of Statistical Software, Articles</em> 27 (8): 1â€“25. <a href="https://doi.org/10.18637/jss.v027.i08">https://doi.org/10.18637/jss.v027.i08</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Theo Bruckbauer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
